// biome-ignore-all lint: generated file
/* eslint-disable */

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __reExport = (target, mod, secondTarget) => (__copyProps(target, mod, "default"), secondTarget && __copyProps(secondTarget, mod, "default"));

// node_modules/workflow/dist/internal/builtins.js
import { registerStepFunction } from "workflow/internal/private";
async function __builtin_response_array_buffer(res) {
  return res.arrayBuffer();
}
__name(__builtin_response_array_buffer, "__builtin_response_array_buffer");
async function __builtin_response_json(res) {
  return res.json();
}
__name(__builtin_response_json, "__builtin_response_json");
async function __builtin_response_text(res) {
  return res.text();
}
__name(__builtin_response_text, "__builtin_response_text");
registerStepFunction("__builtin_response_array_buffer", __builtin_response_array_buffer);
registerStepFunction("__builtin_response_json", __builtin_response_json);
registerStepFunction("__builtin_response_text", __builtin_response_text);

// node_modules/workflow/dist/index.js
var dist_exports = {};
__export(dist_exports, {
  fetch: () => fetch
});
__reExport(dist_exports, core_star);
import * as core_star from "@workflow/core";

// node_modules/workflow/dist/stdlib.js
import { registerStepFunction as registerStepFunction2 } from "workflow/internal/private";
async function fetch(...args) {
  return globalThis.fetch(...args);
}
__name(fetch, "fetch");
registerStepFunction2("step//node_modules/workflow/dist/stdlib.js//fetch", fetch);

// lib/workflows/crm-sync.workflow.ts
import { z } from "zod";
var CRMSyncParamsSchema = z.object({
  userId: z.string().uuid("userId must be a valid UUID"),
  provider: z.enum([
    "bloomerang",
    "virtuous",
    "neoncrm",
    "donorperfect"
  ]),
  apiKey: z.string().min(1, "apiKey is required"),
  syncLogId: z.string().uuid("syncLogId must be a valid UUID")
});
async function syncCRMData(params) {
  throw new Error("You attempted to execute workflow syncCRMData function directly. To start a workflow, use start(syncCRMData) from workflow/api");
}
__name(syncCRMData, "syncCRMData");
syncCRMData.workflowId = "workflow//lib/workflows/crm-sync.workflow.ts//syncCRMData";

// lib/workflows/memory-extraction.workflow.ts
import { z as z2 } from "zod";
var MemoryExtractionParamsSchema = z2.object({
  userId: z2.string().uuid("userId must be a valid UUID"),
  chatId: z2.string().uuid("chatId must be a valid UUID"),
  userMessage: z2.string().min(1, "userMessage is required"),
  assistantResponse: z2.string().min(1, "assistantResponse is required"),
  messageId: z2.string().optional(),
  apiKey: z2.string().optional()
});
async function extractMemoriesWorkflow(params) {
  throw new Error("You attempted to execute workflow extractMemoriesWorkflow function directly. To start a workflow, use start(extractMemoriesWorkflow) from workflow/api");
}
__name(extractMemoriesWorkflow, "extractMemoriesWorkflow");
extractMemoriesWorkflow.workflowId = "workflow//lib/workflows/memory-extraction.workflow.ts//extractMemoriesWorkflow";

// virtual-entry.js
import { stepEntrypoint } from "workflow/runtime";
export {
  stepEntrypoint as POST
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vLi4vbm9kZV9tb2R1bGVzL3dvcmtmbG93L3NyYy9pbnRlcm5hbC9idWlsdGlucy50cyIsICIuLi8uLi8uLi8uLi8uLi9ub2RlX21vZHVsZXMvd29ya2Zsb3cvc3JjL2luZGV4LnRzIiwgIi4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy93b3JrZmxvdy9zcmMvc3RkbGliLnRzIiwgIi4uLy4uLy4uLy4uLy4uL2xpYi93b3JrZmxvd3MvY3JtLXN5bmMud29ya2Zsb3cudHMiLCAiLi4vLi4vLi4vLi4vLi4vbGliL3dvcmtmbG93cy9tZW1vcnktZXh0cmFjdGlvbi53b3JrZmxvdy50cyIsICIuLi8uLi8uLi8uLi8uLi92aXJ0dWFsLWVudHJ5LmpzIl0sCiAgInNvdXJjZXNDb250ZW50IjogW251bGwsIG51bGwsIG51bGwsICIvKipcbiAqIENSTSBTeW5jIER1cmFibGUgV29ya2Zsb3dcbiAqXG4gKiBUaGlzIHdvcmtmbG93IGhhbmRsZXMgQ1JNIGRhdGEgc3luY2hyb25pemF0aW9uIHdpdGg6XG4gKiAtIEF1dG9tYXRpYyByZXRyeSBvbiB0cmFuc2llbnQgZmFpbHVyZXNcbiAqIC0gRHVyYWJsZSBjaGVja3BvaW50aW5nIChyZXN1bWUgYWZ0ZXIgc2VydmVyIHJlc3RhcnQpXG4gKiAtIFN0ZXAtbGV2ZWwgb2JzZXJ2YWJpbGl0eVxuICogLSBSYXRlIGxpbWl0aW5nIHdpdGhvdXQgcmVzb3VyY2UgY29uc3VtcHRpb25cbiAqXG4gKiBTdXBwb3J0czogQmxvb21lcmFuZywgVmlydHVvdXMsIE5lb24gQ1JNLCBEb25vclBlcmZlY3RcbiAqLyBpbXBvcnQgeyBmZXRjaCB9IGZyb20gXCJ3b3JrZmxvd1wiO1xuaW1wb3J0IHsgeiB9IGZyb20gXCJ6b2RcIjtcbi8qKl9faW50ZXJuYWxfd29ya2Zsb3dze1wid29ya2Zsb3dzXCI6e1wibGliL3dvcmtmbG93cy9jcm0tc3luYy53b3JrZmxvdy50c1wiOntcInN5bmNDUk1EYXRhXCI6e1wid29ya2Zsb3dJZFwiOlwid29ya2Zsb3cvL2xpYi93b3JrZmxvd3MvY3JtLXN5bmMud29ya2Zsb3cudHMvL3N5bmNDUk1EYXRhXCJ9fX19Ki87XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBJTlBVVCBWQUxJREFUSU9OIFNDSEVNQVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLyoqXG4gKiBTdHJpY3Qgc2NoZW1hIGZvciBDUk0gc3luYyBwYXJhbWV0ZXJzXG4gKiBVc2VzIFpvZCBmb3IgcnVudGltZSB2YWxpZGF0aW9uXG4gKi8gZXhwb3J0IGNvbnN0IENSTVN5bmNQYXJhbXNTY2hlbWEgPSB6Lm9iamVjdCh7XG4gICAgdXNlcklkOiB6LnN0cmluZygpLnV1aWQoXCJ1c2VySWQgbXVzdCBiZSBhIHZhbGlkIFVVSURcIiksXG4gICAgcHJvdmlkZXI6IHouZW51bShbXG4gICAgICAgIFwiYmxvb21lcmFuZ1wiLFxuICAgICAgICBcInZpcnR1b3VzXCIsXG4gICAgICAgIFwibmVvbmNybVwiLFxuICAgICAgICBcImRvbm9ycGVyZmVjdFwiXG4gICAgXSksXG4gICAgYXBpS2V5OiB6LnN0cmluZygpLm1pbigxLCBcImFwaUtleSBpcyByZXF1aXJlZFwiKSxcbiAgICBzeW5jTG9nSWQ6IHouc3RyaW5nKCkudXVpZChcInN5bmNMb2dJZCBtdXN0IGJlIGEgdmFsaWQgVVVJRFwiKVxufSk7XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBJTlRFUk5BTCBTVEVQIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLyoqXG4gKiBGZXRjaCBhbGwgY29uc3RpdHVlbnRzIGZyb20gQ1JNIHByb3ZpZGVyXG4gKiBUaGlzIGlzIGEgc3RlcCBmdW5jdGlvbiAtIHdpbGwgYmUgY2hlY2twb2ludGVkIGFmdGVyIGNvbXBsZXRpb25cbiAqLyBhc3luYyBmdW5jdGlvbiBmZXRjaENvbnN0aXR1ZW50c1N0ZXAocGFyYW1zKSB7XG4gICAgLy8gRHluYW1pYyBpbXBvcnQgdG8gYXZvaWQgYnVuZGxpbmcgYWxsIENSTSBhZGFwdGVyc1xuICAgIGNvbnN0IHsgZmV0Y2hBbGxCbG9vbWVyYW5nQ29uc3RpdHVlbnRzLCBmZXRjaEFsbFZpcnR1b3VzQ29udGFjdHMsIGZldGNoQWxsTmVvbkNSTUFjY291bnRzLCBmZXRjaEFsbERvbm9yUGVyZmVjdERvbm9ycywgbWFwQmxvb21lcmFuZ0NvbnN0aXR1ZW50LCBtYXBWaXJ0dW91c0NvbnRhY3QsIG1hcE5lb25DUk1BY2NvdW50LCBtYXBEb25vclBlcmZlY3REb25vciwgcGFyc2VOZW9uQ1JNQ3JlZGVudGlhbHMsIENSTV9TWU5DX0NPTkZJRyB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvY3JtXCIpO1xuICAgIGNvbnN0IGNvbnN0aXR1ZW50cyA9IFtdO1xuICAgIGlmIChwYXJhbXMucHJvdmlkZXIgPT09IFwiYmxvb21lcmFuZ1wiKSB7XG4gICAgICAgIGZvciBhd2FpdCAoY29uc3QgYmF0Y2ggb2YgZmV0Y2hBbGxCbG9vbWVyYW5nQ29uc3RpdHVlbnRzKHBhcmFtcy5hcGlLZXksIENSTV9TWU5DX0NPTkZJRy5iYXRjaFNpemUpKXtcbiAgICAgICAgICAgIGZvciAoY29uc3QgYyBvZiBiYXRjaCl7XG4gICAgICAgICAgICAgICAgY29uc3QgbWFwcGVkID0gbWFwQmxvb21lcmFuZ0NvbnN0aXR1ZW50KGMpO1xuICAgICAgICAgICAgICAgIGNvbnN0aXR1ZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ubWFwcGVkLFxuICAgICAgICAgICAgICAgICAgICByYXdEYXRhOiBjXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY29uc3RpdHVlbnRzLmxlbmd0aCA+PSBDUk1fU1lOQ19DT05GSUcubWF4UmVjb3Jkc1BlclVzZXIpIGJyZWFrO1xuICAgICAgICB9XG4gICAgfSBlbHNlIGlmIChwYXJhbXMucHJvdmlkZXIgPT09IFwidmlydHVvdXNcIikge1xuICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGJhdGNoIG9mIGZldGNoQWxsVmlydHVvdXNDb250YWN0cyhwYXJhbXMuYXBpS2V5LCBDUk1fU1lOQ19DT05GSUcuYmF0Y2hTaXplKSl7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGMgb2YgYmF0Y2gpe1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcHBlZCA9IG1hcFZpcnR1b3VzQ29udGFjdChjKTtcbiAgICAgICAgICAgICAgICBjb25zdGl0dWVudHMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIC4uLm1hcHBlZCxcbiAgICAgICAgICAgICAgICAgICAgcmF3RGF0YTogY1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNvbnN0aXR1ZW50cy5sZW5ndGggPj0gQ1JNX1NZTkNfQ09ORklHLm1heFJlY29yZHNQZXJVc2VyKSBicmVhaztcbiAgICAgICAgfVxuICAgIH0gZWxzZSBpZiAocGFyYW1zLnByb3ZpZGVyID09PSBcIm5lb25jcm1cIikge1xuICAgICAgICBjb25zdCBjcmVkZW50aWFscyA9IHBhcnNlTmVvbkNSTUNyZWRlbnRpYWxzKHBhcmFtcy5hcGlLZXkpO1xuICAgICAgICBpZiAoIWNyZWRlbnRpYWxzKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIE5lb24gQ1JNIGNyZWRlbnRpYWxzIGZvcm1hdFwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhY2NvdW50cyA9IGF3YWl0IGZldGNoQWxsTmVvbkNSTUFjY291bnRzKGNyZWRlbnRpYWxzKTtcbiAgICAgICAgZm9yIChjb25zdCBjIG9mIGFjY291bnRzKXtcbiAgICAgICAgICAgIGNvbnN0IG1hcHBlZCA9IG1hcE5lb25DUk1BY2NvdW50KGMpO1xuICAgICAgICAgICAgY29uc3RpdHVlbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgIC4uLm1hcHBlZCxcbiAgICAgICAgICAgICAgICByYXdEYXRhOiBjXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChjb25zdGl0dWVudHMubGVuZ3RoID49IENSTV9TWU5DX0NPTkZJRy5tYXhSZWNvcmRzUGVyVXNlcikgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHBhcmFtcy5wcm92aWRlciA9PT0gXCJkb25vcnBlcmZlY3RcIikge1xuICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGJhdGNoIG9mIGZldGNoQWxsRG9ub3JQZXJmZWN0RG9ub3JzKHBhcmFtcy5hcGlLZXksIENSTV9TWU5DX0NPTkZJRy5iYXRjaFNpemUpKXtcbiAgICAgICAgICAgIGZvciAoY29uc3QgZCBvZiBiYXRjaCl7XG4gICAgICAgICAgICAgICAgY29uc3QgbWFwcGVkID0gbWFwRG9ub3JQZXJmZWN0RG9ub3IoZCk7XG4gICAgICAgICAgICAgICAgY29uc3RpdHVlbnRzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAuLi5tYXBwZWQsXG4gICAgICAgICAgICAgICAgICAgIHJhd0RhdGE6IGRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb25zdGl0dWVudHMubGVuZ3RoID49IENSTV9TWU5DX0NPTkZJRy5tYXhSZWNvcmRzUGVyVXNlcikgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgY29uc3RpdHVlbnRzXG4gICAgfTtcbn1cbi8qKlxuICogRmV0Y2ggYWxsIGRvbmF0aW9ucyBmcm9tIENSTSBwcm92aWRlclxuICovIGFzeW5jIGZ1bmN0aW9uIGZldGNoRG9uYXRpb25zU3RlcChwYXJhbXMpIHtcbiAgICBjb25zdCB7IGZldGNoQWxsQmxvb21lcmFuZ1RyYW5zYWN0aW9ucywgZmV0Y2hBbGxWaXJ0dW91c0dpZnRzLCBmZXRjaEFsbE5lb25DUk1Eb25hdGlvbnMsIGZldGNoQWxsRG9ub3JQZXJmZWN0R2lmdHMsIG1hcEJsb29tZXJhbmdUcmFuc2FjdGlvbiwgbWFwVmlydHVvdXNHaWZ0LCBtYXBOZW9uQ1JNRG9uYXRpb24sIG1hcERvbm9yUGVyZmVjdEdpZnQsIHBhcnNlTmVvbkNSTUNyZWRlbnRpYWxzLCBDUk1fU1lOQ19DT05GSUcgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2NybVwiKTtcbiAgICBjb25zdCBkb25hdGlvbnMgPSBbXTtcbiAgICBpZiAocGFyYW1zLnByb3ZpZGVyID09PSBcImJsb29tZXJhbmdcIikge1xuICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGJhdGNoIG9mIGZldGNoQWxsQmxvb21lcmFuZ1RyYW5zYWN0aW9ucyhwYXJhbXMuYXBpS2V5LCBDUk1fU1lOQ19DT05GSUcuYmF0Y2hTaXplKSl7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgYmF0Y2gpe1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcHBlZCA9IG1hcEJsb29tZXJhbmdUcmFuc2FjdGlvbih0KTtcbiAgICAgICAgICAgICAgICBkb25hdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIC4uLm1hcHBlZCxcbiAgICAgICAgICAgICAgICAgICAgcmF3RGF0YTogdFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSBlbHNlIGlmIChwYXJhbXMucHJvdmlkZXIgPT09IFwidmlydHVvdXNcIikge1xuICAgICAgICBmb3IgYXdhaXQgKGNvbnN0IGJhdGNoIG9mIGZldGNoQWxsVmlydHVvdXNHaWZ0cyhwYXJhbXMuYXBpS2V5LCBDUk1fU1lOQ19DT05GSUcuYmF0Y2hTaXplKSl7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGcgb2YgYmF0Y2gpe1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcHBlZCA9IG1hcFZpcnR1b3VzR2lmdChnKTtcbiAgICAgICAgICAgICAgICBkb25hdGlvbnMucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIC4uLm1hcHBlZCxcbiAgICAgICAgICAgICAgICAgICAgcmF3RGF0YTogZ1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSBlbHNlIGlmIChwYXJhbXMucHJvdmlkZXIgPT09IFwibmVvbmNybVwiKSB7XG4gICAgICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gcGFyc2VOZW9uQ1JNQ3JlZGVudGlhbHMocGFyYW1zLmFwaUtleSk7XG4gICAgICAgIGlmICghY3JlZGVudGlhbHMpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgTmVvbiBDUk0gY3JlZGVudGlhbHMgZm9ybWF0XCIpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGFsbERvbmF0aW9ucyA9IGF3YWl0IGZldGNoQWxsTmVvbkNSTURvbmF0aW9ucyhjcmVkZW50aWFscyk7XG4gICAgICAgIGZvciAoY29uc3QgZCBvZiBhbGxEb25hdGlvbnMpe1xuICAgICAgICAgICAgY29uc3QgbWFwcGVkID0gbWFwTmVvbkNSTURvbmF0aW9uKGQpO1xuICAgICAgICAgICAgZG9uYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgIC4uLm1hcHBlZCxcbiAgICAgICAgICAgICAgICByYXdEYXRhOiBkXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSBpZiAocGFyYW1zLnByb3ZpZGVyID09PSBcImRvbm9ycGVyZmVjdFwiKSB7XG4gICAgICAgIGZvciBhd2FpdCAoY29uc3QgYmF0Y2ggb2YgZmV0Y2hBbGxEb25vclBlcmZlY3RHaWZ0cyhwYXJhbXMuYXBpS2V5LCBDUk1fU1lOQ19DT05GSUcuYmF0Y2hTaXplKSl7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGcgb2YgYmF0Y2gpe1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcHBlZCA9IG1hcERvbm9yUGVyZmVjdEdpZnQoZyk7XG4gICAgICAgICAgICAgICAgZG9uYXRpb25zLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAuLi5tYXBwZWQsXG4gICAgICAgICAgICAgICAgICAgIHJhd0RhdGE6IGdcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBkb25hdGlvbnNcbiAgICB9O1xufVxuLyoqXG4gKiBVcHNlcnQgY29uc3RpdHVlbnRzIHRvIGRhdGFiYXNlIGluIGJhdGNoZXNcbiAqLyBhc3luYyBmdW5jdGlvbiB1cHNlcnRDb25zdGl0dWVudHNTdGVwKGNvbnN0aXR1ZW50cywgdXNlcklkLCBzeW5jTG9nSWQpIHtcbiAgICBjb25zdCB7IGNyZWF0ZUNsaWVudCB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvc3VwYWJhc2Uvc2VydmVyXCIpO1xuICAgIGNvbnN0IHsgQ1JNX1NZTkNfQ09ORklHLCBDUk1fQVBJX0NPTkZJRyB9ID0gYXdhaXQgaW1wb3J0KFwiQC9saWIvY3JtXCIpO1xuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG4gICAgaWYgKCFzdXBhYmFzZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJTdXBhYmFzZSBub3QgY29uZmlndXJlZFwiKTtcbiAgICB9XG4gICAgbGV0IHN5bmNlZCA9IDA7XG4gICAgbGV0IGZhaWxlZCA9IDA7XG4gICAgLy8gUHJvY2VzcyBpbiBiYXRjaGVzIHdpdGggcmF0ZSBsaW1pdGluZ1xuICAgIGZvcihsZXQgaSA9IDA7IGkgPCBjb25zdGl0dWVudHMubGVuZ3RoOyBpICs9IENSTV9TWU5DX0NPTkZJRy5iYXRjaFNpemUpe1xuICAgICAgICBjb25zdCBiYXRjaCA9IGNvbnN0aXR1ZW50cy5zbGljZShpLCBpICsgQ1JNX1NZTkNfQ09ORklHLmJhdGNoU2l6ZSk7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oXCJjcm1fY29uc3RpdHVlbnRzXCIpLnVwc2VydChiYXRjaC5tYXAoKGMpPT4oe1xuICAgICAgICAgICAgICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICAgICAgICAgICAgICBwcm92aWRlcjogYy5wcm92aWRlcixcbiAgICAgICAgICAgICAgICBleHRlcm5hbF9pZDogYy5leHRlcm5hbElkLFxuICAgICAgICAgICAgICAgIGZpcnN0X25hbWU6IGMuZmlyc3ROYW1lLFxuICAgICAgICAgICAgICAgIGxhc3RfbmFtZTogYy5sYXN0TmFtZSxcbiAgICAgICAgICAgICAgICBmdWxsX25hbWU6IGMuZnVsbE5hbWUsXG4gICAgICAgICAgICAgICAgZW1haWw6IGMuZW1haWwsXG4gICAgICAgICAgICAgICAgcGhvbmU6IGMucGhvbmUsXG4gICAgICAgICAgICAgICAgc3RyZWV0X2FkZHJlc3M6IGMuc3RyZWV0QWRkcmVzcyxcbiAgICAgICAgICAgICAgICBjaXR5OiBjLmNpdHksXG4gICAgICAgICAgICAgICAgc3RhdGU6IGMuc3RhdGUsXG4gICAgICAgICAgICAgICAgemlwX2NvZGU6IGMuemlwQ29kZSxcbiAgICAgICAgICAgICAgICBjb3VudHJ5OiBjLmNvdW50cnksXG4gICAgICAgICAgICAgICAgdG90YWxfbGlmZXRpbWVfZ2l2aW5nOiBjLnRvdGFsTGlmZXRpbWVHaXZpbmcsXG4gICAgICAgICAgICAgICAgbGFyZ2VzdF9naWZ0OiBjLmxhcmdlc3RHaWZ0LFxuICAgICAgICAgICAgICAgIGxhc3RfZ2lmdF9hbW91bnQ6IGMubGFzdEdpZnRBbW91bnQsXG4gICAgICAgICAgICAgICAgbGFzdF9naWZ0X2RhdGU6IGMubGFzdEdpZnREYXRlLFxuICAgICAgICAgICAgICAgIGZpcnN0X2dpZnRfZGF0ZTogYy5maXJzdEdpZnREYXRlLFxuICAgICAgICAgICAgICAgIGdpZnRfY291bnQ6IGMuZ2lmdENvdW50LFxuICAgICAgICAgICAgICAgIGN1c3RvbV9maWVsZHM6IGMuY3VzdG9tRmllbGRzIHx8IHt9LFxuICAgICAgICAgICAgICAgIHJhd19kYXRhOiBjLnJhd0RhdGEsXG4gICAgICAgICAgICAgICAgc3luY2VkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgICAgIH0pKSwge1xuICAgICAgICAgICAgb25Db25mbGljdDogXCJ1c2VyX2lkLHByb3ZpZGVyLGV4dGVybmFsX2lkXCJcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIltDUk0gU3luY10gRXJyb3IgdXBzZXJ0aW5nIGNvbnN0aXR1ZW50cyBiYXRjaDpcIiwgZXJyb3IpO1xuICAgICAgICAgICAgZmFpbGVkICs9IGJhdGNoLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHN5bmNlZCArPSBiYXRjaC5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXBkYXRlIHByb2dyZXNzIGluIHN5bmMgbG9nXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oXCJjcm1fc3luY19sb2dzXCIpLnVwZGF0ZSh7XG4gICAgICAgICAgICByZWNvcmRzX3N5bmNlZDogc3luY2VkLFxuICAgICAgICAgICAgcmVjb3Jkc19mYWlsZWQ6IGZhaWxlZFxuICAgICAgICB9KS5lcShcImlkXCIsIHN5bmNMb2dJZCk7XG4gICAgICAgIC8vIFJhdGUgbGltaXQgZGVsYXkgYmV0d2VlbiBiYXRjaGVzXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKT0+c2V0VGltZW91dChyZXNvbHZlLCBDUk1fQVBJX0NPTkZJRy5yYXRlTGltaXREZWxheSkpO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBzeW5jZWQsXG4gICAgICAgIGZhaWxlZFxuICAgIH07XG59XG4vKipcbiAqIFVwc2VydCBkb25hdGlvbnMgdG8gZGF0YWJhc2UgaW4gYmF0Y2hlc1xuICovIGFzeW5jIGZ1bmN0aW9uIHVwc2VydERvbmF0aW9uc1N0ZXAoZG9uYXRpb25zLCB1c2VySWQsIHN5bmNMb2dJZCwgcHJldmlvdXNTeW5jZWQsIHByZXZpb3VzRmFpbGVkKSB7XG4gICAgY29uc3QgeyBjcmVhdGVDbGllbnQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL3N1cGFiYXNlL3NlcnZlclwiKTtcbiAgICBjb25zdCB7IENSTV9TWU5DX0NPTkZJRywgQ1JNX0FQSV9DT05GSUcgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL2NybVwiKTtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuICAgIGlmICghc3VwYWJhc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3VwYWJhc2Ugbm90IGNvbmZpZ3VyZWRcIik7XG4gICAgfVxuICAgIGxldCBzeW5jZWQgPSBwcmV2aW91c1N5bmNlZDtcbiAgICBsZXQgZmFpbGVkID0gcHJldmlvdXNGYWlsZWQ7XG4gICAgZm9yKGxldCBpID0gMDsgaSA8IGRvbmF0aW9ucy5sZW5ndGg7IGkgKz0gQ1JNX1NZTkNfQ09ORklHLmJhdGNoU2l6ZSl7XG4gICAgICAgIGNvbnN0IGJhdGNoID0gZG9uYXRpb25zLnNsaWNlKGksIGkgKyBDUk1fU1lOQ19DT05GSUcuYmF0Y2hTaXplKTtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbShcImNybV9kb25hdGlvbnNcIikudXBzZXJ0KGJhdGNoLm1hcCgoZCk9Pih7XG4gICAgICAgICAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICAgICAgICAgIHByb3ZpZGVyOiBkLnByb3ZpZGVyLFxuICAgICAgICAgICAgICAgIGV4dGVybmFsX2lkOiBkLmV4dGVybmFsSWQsXG4gICAgICAgICAgICAgICAgY29uc3RpdHVlbnRfZXh0ZXJuYWxfaWQ6IGQuY29uc3RpdHVlbnRFeHRlcm5hbElkLFxuICAgICAgICAgICAgICAgIGFtb3VudDogZC5hbW91bnQsXG4gICAgICAgICAgICAgICAgZG9uYXRpb25fZGF0ZTogZC5kb25hdGlvbkRhdGUsXG4gICAgICAgICAgICAgICAgZG9uYXRpb25fdHlwZTogZC5kb25hdGlvblR5cGUsXG4gICAgICAgICAgICAgICAgY2FtcGFpZ25fbmFtZTogZC5jYW1wYWlnbk5hbWUsXG4gICAgICAgICAgICAgICAgZnVuZF9uYW1lOiBkLmZ1bmROYW1lLFxuICAgICAgICAgICAgICAgIHBheW1lbnRfbWV0aG9kOiBkLnBheW1lbnRNZXRob2QsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBkLnN0YXR1cyxcbiAgICAgICAgICAgICAgICBub3RlczogZC5ub3RlcyxcbiAgICAgICAgICAgICAgICBjdXN0b21fZmllbGRzOiBkLmN1c3RvbUZpZWxkcyB8fCB7fSxcbiAgICAgICAgICAgICAgICByYXdfZGF0YTogZC5yYXdEYXRhLFxuICAgICAgICAgICAgICAgIHN5bmNlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgICAgICB9KSksIHtcbiAgICAgICAgICAgIG9uQ29uZmxpY3Q6IFwidXNlcl9pZCxwcm92aWRlcixleHRlcm5hbF9pZFwiXG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJbQ1JNIFN5bmNdIEVycm9yIHVwc2VydGluZyBkb25hdGlvbnMgYmF0Y2g6XCIsIGVycm9yKTtcbiAgICAgICAgICAgIGZhaWxlZCArPSBiYXRjaC5sZW5ndGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzeW5jZWQgKz0gYmF0Y2gubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIC8vIFVwZGF0ZSBwcm9ncmVzc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiY3JtX3N5bmNfbG9nc1wiKS51cGRhdGUoe1xuICAgICAgICAgICAgcmVjb3Jkc19zeW5jZWQ6IHN5bmNlZCxcbiAgICAgICAgICAgIHJlY29yZHNfZmFpbGVkOiBmYWlsZWRcbiAgICAgICAgfSkuZXEoXCJpZFwiLCBzeW5jTG9nSWQpO1xuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSk9PnNldFRpbWVvdXQocmVzb2x2ZSwgQ1JNX0FQSV9DT05GSUcucmF0ZUxpbWl0RGVsYXkpKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3luY2VkLFxuICAgICAgICBmYWlsZWRcbiAgICB9O1xufVxuLyoqXG4gKiBNYXJrIHN5bmMgYXMgY29tcGxldGVkIGluIGRhdGFiYXNlXG4gKi8gYXN5bmMgZnVuY3Rpb24gbWFya1N5bmNDb21wbGV0ZVN0ZXAoc3luY0xvZ0lkLCByZWNvcmRzU3luY2VkLCByZWNvcmRzRmFpbGVkKSB7XG4gICAgY29uc3QgeyBjcmVhdGVDbGllbnQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL3N1cGFiYXNlL3NlcnZlclwiKTtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuICAgIGlmICghc3VwYWJhc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3VwYWJhc2Ugbm90IGNvbmZpZ3VyZWRcIik7XG4gICAgfVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbShcImNybV9zeW5jX2xvZ3NcIikudXBkYXRlKHtcbiAgICAgICAgc3RhdHVzOiBcImNvbXBsZXRlZFwiLFxuICAgICAgICByZWNvcmRzX3N5bmNlZDogcmVjb3Jkc1N5bmNlZCxcbiAgICAgICAgcmVjb3Jkc19mYWlsZWQ6IHJlY29yZHNGYWlsZWQsXG4gICAgICAgIGNvbXBsZXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfSkuZXEoXCJpZFwiLCBzeW5jTG9nSWQpO1xufVxuLyoqXG4gKiBNYXJrIHN5bmMgYXMgZmFpbGVkIGluIGRhdGFiYXNlXG4gKi8gYXN5bmMgZnVuY3Rpb24gbWFya1N5bmNGYWlsZWRTdGVwKHN5bmNMb2dJZCwgcmVjb3Jkc1N5bmNlZCwgcmVjb3Jkc0ZhaWxlZCwgZXJyb3JNZXNzYWdlKSB7XG4gICAgY29uc3QgeyBjcmVhdGVDbGllbnQgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL3N1cGFiYXNlL3NlcnZlclwiKTtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuICAgIGlmICghc3VwYWJhc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiU3VwYWJhc2Ugbm90IGNvbmZpZ3VyZWRcIik7XG4gICAgfVxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgYXdhaXQgc3VwYWJhc2UuZnJvbShcImNybV9zeW5jX2xvZ3NcIikudXBkYXRlKHtcbiAgICAgICAgc3RhdHVzOiBcImZhaWxlZFwiLFxuICAgICAgICByZWNvcmRzX3N5bmNlZDogcmVjb3Jkc1N5bmNlZCxcbiAgICAgICAgcmVjb3Jkc19mYWlsZWQ6IHJlY29yZHNGYWlsZWQsXG4gICAgICAgIGVycm9yX21lc3NhZ2U6IGVycm9yTWVzc2FnZSxcbiAgICAgICAgY29tcGxldGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICB9KS5lcShcImlkXCIsIHN5bmNMb2dJZCk7XG59XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBNQUlOIFdPUktGTE9XIEZVTkNUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vKipcbiAqIER1cmFibGUgQ1JNIFN5bmMgV29ya2Zsb3dcbiAqXG4gKiBUaGlzIGlzIHRoZSBtYWluIHdvcmtmbG93IGZ1bmN0aW9uIHRoYXQgb3JjaGVzdHJhdGVzIHRoZSBDUk0gc3luYyBwcm9jZXNzLlxuICogRWFjaCBzdGVwIGlzIGF1dG9tYXRpY2FsbHkgY2hlY2twb2ludGVkLCBhbGxvd2luZyB0aGUgd29ya2Zsb3cgdG8gcmVzdW1lXG4gKiBmcm9tIHRoZSBsYXN0IGNvbXBsZXRlZCBzdGVwIGlmIGludGVycnVwdGVkLlxuICpcbiAqIEBwYXJhbSBwYXJhbXMgLSBWYWxpZGF0ZWQgc3luYyBwYXJhbWV0ZXJzXG4gKiBAcmV0dXJucyBDUk1TeW5jUmVzdWx0IHdpdGggY291bnRzIGFuZCBkdXJhdGlvblxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyBzeW5jQ1JNRGF0YSB9IGZyb20gXCJAL2xpYi93b3JrZmxvd3MvY3JtLXN5bmMud29ya2Zsb3dcIlxuICogaW1wb3J0IHsgcnVuRHVyYWJsZVdvcmtmbG93IH0gZnJvbSBcIkAvbGliL3dvcmtmbG93c1wiXG4gKlxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuRHVyYWJsZVdvcmtmbG93KHN5bmNDUk1EYXRhLCB7XG4gKiAgIHVzZXJJZDogdXNlci5pZCxcbiAqICAgcHJvdmlkZXI6IFwiYmxvb21lcmFuZ1wiLFxuICogICBhcGlLZXk6IGRlY3J5cHRlZEtleSxcbiAqICAgc3luY0xvZ0lkOiBzeW5jTG9nLmlkLFxuICogfSlcbiAqIGBgYFxuICovIGV4cG9ydCBhc3luYyBmdW5jdGlvbiBzeW5jQ1JNRGF0YShwYXJhbXMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgYXR0ZW1wdGVkIHRvIGV4ZWN1dGUgd29ya2Zsb3cgc3luY0NSTURhdGEgZnVuY3Rpb24gZGlyZWN0bHkuIFRvIHN0YXJ0IGEgd29ya2Zsb3csIHVzZSBzdGFydChzeW5jQ1JNRGF0YSkgZnJvbSB3b3JrZmxvdy9hcGlcIik7XG59XG5zeW5jQ1JNRGF0YS53b3JrZmxvd0lkID0gXCJ3b3JrZmxvdy8vbGliL3dvcmtmbG93cy9jcm0tc3luYy53b3JrZmxvdy50cy8vc3luY0NSTURhdGFcIjtcbiIsICIvKipcbiAqIE1lbW9yeSBFeHRyYWN0aW9uIER1cmFibGUgV29ya2Zsb3dcbiAqXG4gKiBUaGlzIHdvcmtmbG93IGhhbmRsZXMgbWVtb3J5IGV4dHJhY3Rpb24gZnJvbSBjb252ZXJzYXRpb25zIHdpdGg6XG4gKiAtIEF1dG9tYXRpYyByZXRyeSBvbiB0cmFuc2llbnQgZmFpbHVyZXMgKGVtYmVkZGluZyBBUEksIGRhdGFiYXNlKVxuICogLSBEdXJhYmxlIGNoZWNrcG9pbnRpbmcgKHJlc3VtZSBhZnRlciBzZXJ2ZXIgcmVzdGFydClcbiAqIC0gU3RlcC1sZXZlbCBvYnNlcnZhYmlsaXR5XG4gKlxuICogVW5saWtlIGZpcmUtYW5kLWZvcmdldCwgdGhpcyBlbnN1cmVzIG1lbW9yaWVzIGFyZSBldmVudHVhbGx5IHNhdmVkLlxuICovIGltcG9ydCB7IGZldGNoIH0gZnJvbSBcIndvcmtmbG93XCI7XG5pbXBvcnQgeyB6IH0gZnJvbSBcInpvZFwiO1xuLyoqX19pbnRlcm5hbF93b3JrZmxvd3N7XCJ3b3JrZmxvd3NcIjp7XCJsaWIvd29ya2Zsb3dzL21lbW9yeS1leHRyYWN0aW9uLndvcmtmbG93LnRzXCI6e1wiZXh0cmFjdE1lbW9yaWVzV29ya2Zsb3dcIjp7XCJ3b3JrZmxvd0lkXCI6XCJ3b3JrZmxvdy8vbGliL3dvcmtmbG93cy9tZW1vcnktZXh0cmFjdGlvbi53b3JrZmxvdy50cy8vZXh0cmFjdE1lbW9yaWVzV29ya2Zsb3dcIn19fX0qLztcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIElOUFVUIFZBTElEQVRJT04gU0NIRU1BXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vKipcbiAqIFN0cmljdCBzY2hlbWEgZm9yIG1lbW9yeSBleHRyYWN0aW9uIHBhcmFtZXRlcnNcbiAqLyBleHBvcnQgY29uc3QgTWVtb3J5RXh0cmFjdGlvblBhcmFtc1NjaGVtYSA9IHoub2JqZWN0KHtcbiAgICB1c2VySWQ6IHouc3RyaW5nKCkudXVpZChcInVzZXJJZCBtdXN0IGJlIGEgdmFsaWQgVVVJRFwiKSxcbiAgICBjaGF0SWQ6IHouc3RyaW5nKCkudXVpZChcImNoYXRJZCBtdXN0IGJlIGEgdmFsaWQgVVVJRFwiKSxcbiAgICB1c2VyTWVzc2FnZTogei5zdHJpbmcoKS5taW4oMSwgXCJ1c2VyTWVzc2FnZSBpcyByZXF1aXJlZFwiKSxcbiAgICBhc3Npc3RhbnRSZXNwb25zZTogei5zdHJpbmcoKS5taW4oMSwgXCJhc3Npc3RhbnRSZXNwb25zZSBpcyByZXF1aXJlZFwiKSxcbiAgICBtZXNzYWdlSWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgICBhcGlLZXk6IHouc3RyaW5nKCkub3B0aW9uYWwoKVxufSk7XG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBTVEVQIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLyoqXG4gKiBDaGVjayBpZiBhbiBleHBsaWNpdCBtZW1vcnkgcmVxdWVzdCBleGlzdHMgaW4gdGhlIHVzZXIgbWVzc2FnZVxuICovIGFzeW5jIGZ1bmN0aW9uIGRldGVjdEV4cGxpY2l0TWVtb3J5U3RlcCh1c2VyTWVzc2FnZSkge1xuICAgIGNvbnN0IHsgZGV0ZWN0RXhwbGljaXRNZW1vcnkgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL21lbW9yeS9leHRyYWN0b3JcIik7XG4gICAgY29uc3QgY29udGVudCA9IGRldGVjdEV4cGxpY2l0TWVtb3J5KHVzZXJNZXNzYWdlKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBoYXNFeHBsaWNpdDogISFjb250ZW50LFxuICAgICAgICBjb250ZW50XG4gICAgfTtcbn1cbi8qKlxuICogRXh0cmFjdCBtZW1vcmllcyBmcm9tIGNvbnZlcnNhdGlvbiB1c2luZyBBSVxuICovIGFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RNZW1vcmllc1N0ZXAodXNlcklkLCBjaGF0SWQsIHVzZXJNZXNzYWdlLCBhc3Npc3RhbnRSZXNwb25zZSwgYXBpS2V5KSB7XG4gICAgY29uc3QgeyBleHRyYWN0TWVtb3JpZXMgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL21lbW9yeS9leHRyYWN0b3JcIik7XG4gICAgY29uc3QgbWVtb3JpZXMgPSBhd2FpdCBleHRyYWN0TWVtb3JpZXMoe1xuICAgICAgICBtZXNzYWdlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJvbGU6IFwidXNlclwiLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHVzZXJNZXNzYWdlXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHJvbGU6IFwiYXNzaXN0YW50XCIsXG4gICAgICAgICAgICAgICAgY29udGVudDogYXNzaXN0YW50UmVzcG9uc2VcbiAgICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBjaGF0SWRcbiAgICB9LCBhcGlLZXkpO1xuICAgIHJldHVybiB7XG4gICAgICAgIG1lbW9yaWVzXG4gICAgfTtcbn1cbi8qKlxuICogQ2hlY2sgaWYgYSBtZW1vcnkgYWxyZWFkeSBleGlzdHMgKGRlZHVwbGljYXRpb24pXG4gKi8gYXN5bmMgZnVuY3Rpb24gY2hlY2tEdXBsaWNhdGVTdGVwKGNvbnRlbnQsIHVzZXJJZCwgYXBpS2V5KSB7XG4gICAgY29uc3QgeyBtZW1vcnlFeGlzdHMgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL21lbW9yeS9zdG9yYWdlXCIpO1xuICAgIGNvbnN0IGV4aXN0cyA9IGF3YWl0IG1lbW9yeUV4aXN0cyhjb250ZW50LCB1c2VySWQsIGFwaUtleSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZXhpc3RzXG4gICAgfTtcbn1cbi8qKlxuICogR2VuZXJhdGUgZW1iZWRkaW5nIGZvciBtZW1vcnkgY29udGVudFxuICovIGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlRW1iZWRkaW5nU3RlcChjb250ZW50LCBhcGlLZXkpIHtcbiAgICBjb25zdCB7IGdlbmVyYXRlRW1iZWRkaW5nIH0gPSBhd2FpdCBpbXBvcnQoXCJAL2xpYi9yYWcvZW1iZWRkaW5nc1wiKTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBnZW5lcmF0ZUVtYmVkZGluZyhjb250ZW50LCBhcGlLZXkpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGVtYmVkZGluZzogcmVzdWx0LmVtYmVkZGluZ1xuICAgIH07XG59XG4vKipcbiAqIFNhdmUgYSBtZW1vcnkgdG8gdGhlIGRhdGFiYXNlXG4gKi8gYXN5bmMgZnVuY3Rpb24gc2F2ZU1lbW9yeVN0ZXAocGFyYW1zKSB7XG4gICAgY29uc3QgeyBjcmVhdGVNZW1vcnkgfSA9IGF3YWl0IGltcG9ydChcIkAvbGliL21lbW9yeS9zdG9yYWdlXCIpO1xuICAgIGNvbnN0IHNhdmVkTWVtb3J5ID0gYXdhaXQgY3JlYXRlTWVtb3J5KHtcbiAgICAgICAgdXNlcl9pZDogcGFyYW1zLnVzZXJJZCxcbiAgICAgICAgY29udGVudDogcGFyYW1zLmNvbnRlbnQsXG4gICAgICAgIG1lbW9yeV90eXBlOiBwYXJhbXMubWVtb3J5VHlwZSxcbiAgICAgICAgaW1wb3J0YW5jZV9zY29yZTogcGFyYW1zLmltcG9ydGFuY2VTY29yZSxcbiAgICAgICAgbWV0YWRhdGE6IHBhcmFtcy5tZXRhZGF0YSxcbiAgICAgICAgZW1iZWRkaW5nOiBwYXJhbXMuZW1iZWRkaW5nXG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2F2ZWQ6ICEhc2F2ZWRNZW1vcnlcbiAgICB9O1xufVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gTUFJTiBXT1JLRkxPVyBGVU5DVElPTlxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLyoqXG4gKiBEdXJhYmxlIE1lbW9yeSBFeHRyYWN0aW9uIFdvcmtmbG93XG4gKlxuICogRXh0cmFjdHMgaW1wb3J0YW50IGZhY3RzIGZyb20gY29udmVyc2F0aW9ucyBhbmQgc2F2ZXMgdGhlbSBhcyBtZW1vcmllcy5cbiAqIEVhY2ggc3RlcCBpcyBjaGVja3BvaW50ZWQsIGVuc3VyaW5nIG1lbW9yaWVzIGFyZSBldmVudHVhbGx5IHNhdmVkIGV2ZW5cbiAqIGlmIHRoZSBzZXJ2ZXIgcmVzdGFydHMgbWlkLXByb2Nlc3NpbmcuXG4gKlxuICogQHBhcmFtIHBhcmFtcyAtIFZhbGlkYXRlZCBleHRyYWN0aW9uIHBhcmFtZXRlcnNcbiAqIEByZXR1cm5zIE1lbW9yeUV4dHJhY3Rpb25SZXN1bHQgd2l0aCBjb3VudHMgYW5kIHN0YXR1c1xuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyBleHRyYWN0TWVtb3JpZXNXb3JrZmxvdyB9IGZyb20gXCJAL2xpYi93b3JrZmxvd3MvbWVtb3J5LWV4dHJhY3Rpb24ud29ya2Zsb3dcIlxuICogaW1wb3J0IHsgcnVuRHVyYWJsZVdvcmtmbG93IH0gZnJvbSBcIkAvbGliL3dvcmtmbG93c1wiXG4gKlxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuRHVyYWJsZVdvcmtmbG93KGV4dHJhY3RNZW1vcmllc1dvcmtmbG93LCB7XG4gKiAgIHVzZXJJZDogdXNlci5pZCxcbiAqICAgY2hhdElkOiBjaGF0LmlkLFxuICogICB1c2VyTWVzc2FnZTogXCJSZW1lbWJlciB0aGF0IG15IGRvZydzIG5hbWUgaXMgTWF4XCIsXG4gKiAgIGFzc2lzdGFudFJlc3BvbnNlOiBcIkknbGwgcmVtZW1iZXIgdGhhdC4uLlwiLFxuICogfSlcbiAqIGBgYFxuICovIGV4cG9ydCBhc3luYyBmdW5jdGlvbiBleHRyYWN0TWVtb3JpZXNXb3JrZmxvdyhwYXJhbXMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJZb3UgYXR0ZW1wdGVkIHRvIGV4ZWN1dGUgd29ya2Zsb3cgZXh0cmFjdE1lbW9yaWVzV29ya2Zsb3cgZnVuY3Rpb24gZGlyZWN0bHkuIFRvIHN0YXJ0IGEgd29ya2Zsb3csIHVzZSBzdGFydChleHRyYWN0TWVtb3JpZXNXb3JrZmxvdykgZnJvbSB3b3JrZmxvdy9hcGlcIik7XG59XG5leHRyYWN0TWVtb3JpZXNXb3JrZmxvdy53b3JrZmxvd0lkID0gXCJ3b3JrZmxvdy8vbGliL3dvcmtmbG93cy9tZW1vcnktZXh0cmFjdGlvbi53b3JrZmxvdy50cy8vZXh0cmFjdE1lbW9yaWVzV29ya2Zsb3dcIjtcbiIsICJcbiAgICAvLyBCdWlsdCBpbiBzdGVwc1xuICAgIGltcG9ydCAnd29ya2Zsb3cvaW50ZXJuYWwvYnVpbHRpbnMnO1xuICAgIC8vIFVzZXIgc3RlcHNcbiAgICBpbXBvcnQgJy4vbGliL3dvcmtmbG93cy9jcm0tc3luYy53b3JrZmxvdy50cyc7XG5pbXBvcnQgJy4vbGliL3dvcmtmbG93cy9tZW1vcnktZXh0cmFjdGlvbi53b3JrZmxvdy50cyc7XG5pbXBvcnQgJy4vbm9kZV9tb2R1bGVzL3dvcmtmbG93L2Rpc3Qvc3RkbGliLmpzJztcbiAgICAvLyBBUEkgZW50cnlwb2ludFxuICAgIGV4cG9ydCB7IHN0ZXBFbnRyeXBvaW50IGFzIFBPU1QgfSBmcm9tICd3b3JrZmxvdy9ydW50aW1lJzsiXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLFNBQUEsNEJBQUE7QUFPRSxlQUFXLGdDQUFBLEtBQUE7QUFDWCxTQUFPLElBQUksWUFBVztBQUN4QjtBQUZhO0FBSWIsZUFBc0Isd0JBQXdCLEtBQWE7QUFDekQsU0FBQSxJQUFXLEtBQUE7O0FBRFM7QUFHdEIsZUFBQyx3QkFBQSxLQUFBO0FBRUQsU0FBTyxJQUFLLEtBQUE7O0FBRlg7cUJBSWtCLG1DQUFDLCtCQUFBO0FBQ3BCLHFCQUFDLDJCQUFBLHVCQUFBOzs7O0FDbkJEOzs7OzsyQkFBYzs7O0FDQWQsU0FBQSx3QkFBQUEsNkJBQUE7QUFhQSxlQUFzQixTQUFrRCxNQUFBO0FBQ3RFLFNBQUEsV0FBVyxNQUFBLEdBQUEsSUFBQTs7QUFEUztBQUd0QkMsc0JBQUMscURBQUEsS0FBQTs7O0FDTEQsU0FBUyxTQUFTO0FBUVAsSUFBTSxzQkFBc0IsRUFBRSxPQUFPO0FBQUEsRUFDNUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxLQUFLLDZCQUE2QjtBQUFBLEVBQ3JELFVBQVUsRUFBRSxLQUFLO0FBQUEsSUFDYjtBQUFBLElBQ0E7QUFBQSxJQUNBO0FBQUEsSUFDQTtBQUFBLEVBQ0osQ0FBQztBQUFBLEVBQ0QsUUFBUSxFQUFFLE9BQU8sRUFBRSxJQUFJLEdBQUcsb0JBQW9CO0FBQUEsRUFDOUMsV0FBVyxFQUFFLE9BQU8sRUFBRSxLQUFLLGdDQUFnQztBQUMvRCxDQUFDO0FBK1JHLGVBQXNCLFlBQVksUUFBUTtBQUMxQyxRQUFNLElBQUksTUFBTSxnSUFBZ0k7QUFDcEo7QUFGMEI7QUFHMUIsWUFBWSxhQUFhOzs7QUNyVHpCLFNBQVMsS0FBQUMsVUFBUztBQU9QLElBQU0sK0JBQStCQyxHQUFFLE9BQU87QUFBQSxFQUNyRCxRQUFRQSxHQUFFLE9BQU8sRUFBRSxLQUFLLDZCQUE2QjtBQUFBLEVBQ3JELFFBQVFBLEdBQUUsT0FBTyxFQUFFLEtBQUssNkJBQTZCO0FBQUEsRUFDckQsYUFBYUEsR0FBRSxPQUFPLEVBQUUsSUFBSSxHQUFHLHlCQUF5QjtBQUFBLEVBQ3hELG1CQUFtQkEsR0FBRSxPQUFPLEVBQUUsSUFBSSxHQUFHLCtCQUErQjtBQUFBLEVBQ3BFLFdBQVdBLEdBQUUsT0FBTyxFQUFFLFNBQVM7QUFBQSxFQUMvQixRQUFRQSxHQUFFLE9BQU8sRUFBRSxTQUFTO0FBQ2hDLENBQUM7QUErRkcsZUFBc0Isd0JBQXdCLFFBQVE7QUFDdEQsUUFBTSxJQUFJLE1BQU0sd0pBQXdKO0FBQzVLO0FBRjBCO0FBRzFCLHdCQUF3QixhQUFhOzs7QUNsSGpDLFNBQTJCLHNCQUFZOyIsCiAgIm5hbWVzIjogWyJyZWdpc3RlclN0ZXBGdW5jdGlvbiIsICJyZWdpc3RlclN0ZXBGdW5jdGlvbiIsICJ6IiwgInoiXQp9Cg==
